{% extends "base_template.html" %}
{% block main %}
    {% load static %}
    <div class="modal fade" id="exammarqueeModal" tabindex="-1" role="dialog" aria-labelledby="exammarqueeModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="pt-3">Prediction:</h5>
                    <div id="prediction"style="font-size: larger;font-weight: bold;margin-top: 5px"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary"style="display: flex;justify-content: flex-end;margin-top: 20px" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Intro -->
    <section id="intro-3" style="margin-top: 100px;padding-bottom:150px">
        <div class="container">
            <div class="row">
                <div class="col-md-5">

                    <div class="sidebar_widget sidebar_3">


                        <div class="widget_heading">

                            <h5><i class="fa fa-filter" aria-hidden="true"></i>Estimate Fuel Consumption</h5>

                        </div>


                        <div class="sidebar_filter">

                            <form action="" id="post-form">
                                {% csrf_token %}
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="marque">
                                            <option value="">Select Brand</option>
                                            {% for marque in marques %}
                                                <option value="{{ marque }}">{{ marque }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="voiture">
                                            <option value="">Select Model</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="moteur">
                                            <option value="">Select Motor</option>
                                            {% for motor in moteurs %}
                                                <option value="{{ motor }}">{{ motor }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="carburant">
                                            <option>Fuel Type</option>
                                            <option>Essence</option>
                                            <option>Diesel</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="year">
                                            <option>Select Year</option>
                                            <option value="1980">1980</option>
                                            <option value="1981">1981</option>
                                            <option value="1982">1982</option>
                                            <option value="1983">1983</option>
                                            <option value="1984">1984</option>
                                            <option value="1985">1985</option>
                                            <option value="1986">1986</option>
                                            <option value="1987">1987</option>
                                            <option value="1988">1988</option>
                                            <option value="1989">1989</option>
                                            <option value="1990">1990</option>
                                            <option value="1991">1991</option>
                                            <option value="1992">1992</option>
                                            <option value="1993">1993</option>
                                            <option value="1994">1994</option>
                                            <option value="1995">1995</option>
                                            <option value="1996">1996</option>
                                            <option value="1997">1997</option>
                                            <option value="1998">1998</option>
                                            <option value="1999">1999</option>
                                            <option value="2000">2000</option>
                                            <option value="2001">2001</option>
                                            <option value="2002">2002</option>
                                            <option value="2003">2003</option>
                                            <option value="2004">2004</option>
                                            <option value="2005">2005</option>
                                            <option value="2006">2006</option>
                                            <option value="2007">2007</option>
                                            <option value="2008">2008</option>
                                            <option value="2009">2009</option>
                                            <option value="2010">2010</option>
                                            <option value="2011">2011</option>
                                            <option value="2012">2012</option>
                                            <option value="2013">2013</option>
                                            <option value="2014">2014</option>
                                            <option value="2015">2015</option>
                                            <option value="2016">2016</option>
                                            <option value="2017">2017</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020">2020</option>
                                            <option value="2021">2021</option>
                                            <option value="2022">2022</option>
                                        </select>

                                    </div>
                                </div>
                                <div class="form-group col-md-6">
                                    <div class="select">
                                        <select class="form-control" id="cv">
                                            <option>Horsepower</option>
                                            <option>4</option>
                                            <option>5</option>
                                            <option>6</option>
                                            <option>7</option>
                                            <option>8</option>
                                            <option>9</option>
                                            <option>10</option>
                                            <option>11</option>
                                            <option>12</option>
                                            <option>13</option>
                                            <option>14</option>
                                            <option>15</option>
                                            <option>16</option>
                                            <option>17</option>
                                            <option>18</option>
                                            <option>19</option>
                                            <option>20</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-md-12">
                                    <button type="submit" class="btn btn-block" data-toggle="modal"
                                            data-target="#exammarqueeModal"><i class="fa fa-search"
                                                                               aria-hidden="true"></i> Estimate
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>


                </div>
                <div class="col-md-7">
                    <div class="intro-img-wp">
                        <img style="height: 500px;width: auto;margin-top: 10px;margin-left: 30px"
                             src="{% static "images/pump.png" %}" alt="image">
                    </div>
                </div>

            </div>
        </div>
    </section>
    <!-- /Intro -->
    <script>
        $(document).on('submit', '#post-form', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "predict:fuelpredict" %}',
                data: {
                    moteur: $('#moteur').val(),
                    carburant: $('#carburant').val(),
                    marque: $('#marque').val(),
                    cv: $('#cv').val(),
                    year: $('#year').val(),
                    voiture: $('#voiture').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    document.forms["post-form"].reset();
                    document.getElementById("prediction").innerHTML = json['result'] + ' liters/100KM'
                },
                error: function (xhr, errmsg, err) {

                }
            });
        })
    </script>
    <script>
        $("#marque").change(function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "predict:get_models_fuel" %}',
                data: {
                    marque: $('#marque').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    document.getElementById("voiture").innerHTML = "";
                    select = document.getElementById("voiture")
                    for (var i in json) {
                        for (var j in json[i]) {
                            $(select).append('<option value=' + json[i][j] + '>' + json[i][j] + '</option>');
                        }
                    }

                },
                error: function (xhr, errmsg, err) {

                }
            });
        })
    </script>
    <script>
        $("#voiture").change(function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "predict:get_moteurs_fuel" %}',
                data: {
                    voiture: $('#voiture').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    document.getElementById("moteur").innerHTML = "";
                    select = document.getElementById("moteur")
                    for (var i in json) {
                        for (var j in json[i]) {
                            $(select).append('<option value=' + json[i][j] + '>' + json[i][j] + '</option>');
                        }
                    }

                },
                error: function (xhr, errmsg, err) {

                }
            });
        })
    </script>


{% endblock %}