{% extends "base_template.html" %}
{% block main %}
    {% load static %}
    <div class="modal fade" id="exammarqueeModal" tabindex="-1" role="dialog" aria-labelledby="exammarqueeModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <h5 class="pt-3">Prediction Result:</h5>
                    <div>The chosen car price is:</div>
                    <div id="prediction" style="font-size: larger;font-weight: bold;margin-top: 5px"></div>
                    <button type="button" style="display: flex;justify-content: flex-end;margin-top: 20px"
                            class="btn btn-secondary" data-dismiss="modal">Close
                    </button>

                </div>
            </div>
        </div>
    </div>
    <!--Banner-->
    <section id="banner2">
        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <!-- Wrapper for slides -->
            <div class="carousel-inner">
                <!--item-1-->

                <!--item-2-->
                <div class="item active">
                    <img src="{% static "images/fuel.png" %}" alt="image">
                    <div class="carousel-caption">
                        <div class="banner_text text-center div_zindex white-text">
                            <h1>Estimate a car's fuel consumption.</h1>
                            <a href="{% url "predict:fuel_index" %}" class="btn">Read More</a>
                        </div>
                    </div>
                </div>
                <div class="item">
                    <img src="{% static "images/sentiment.png" %}" alt="image">
                    <div class="carousel-caption">
                        <div class="banner_text text-center div_zindex white-text">
                            <h1>Consult Sentiment Reports for a car.</h1>
                            <a href="{% url "predict:sa_index" %}" class="btn">Read More</a>
                        </div>
                    </div>
                </div>
                <div class="item">
                    <img src="{% static "images/dashboard.png" %}" alt="image">
                    <div class="carousel-caption">
                        <div class="banner_text text-center div_zindex white-text">
                            <h1>Consult Admin Dashboard.</h1>
                            <a href="{% url "predict:dashboard" %}" class="btn">Read More</a>
                        </div>
                    </div>
                </div>
                <div class="item">
                    <img src="{% static "images/detection.png" %}" alt="image">
                    <div class="carousel-caption">
                        <div class="banner_text text-center div_zindex white-text">
                            <h1>Find a car's price via an image.</h1>
                            <a href="{% url "predict:detection" %}" class="btn">Read More</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                <div class="icon-prev"></div>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                <div class="icon-next"></div>
            </a>
        </div>
    </section>
    <!--/Banner-->


    <!-- Filter-Form -->
    <section id="filter_form2">
        <div class="container">
            <div class="main_bg white-text">
                <h3>Find Your Dream Car</h3>
                <div class="row">
                    <form action="" id="post-form">
                        {% csrf_token %}
                        <div class="form-group col-md-3 col-sm-6">
                            <div class="select">
                                <select class="form-control" id="marque" required>
                                    <option value="">Select Brand</option>
                                    {% for marque in marques %}
                                        <option value="{{ marque }}">{{ marque }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="form-group col-md-3 col-sm-6">
                            <div class="select">
                                <select class="form-control" id="model" required>
                                    <option value="">Select Model</option>
                                    {#                                    {% for model in models %}#}
                                    {#                                        <option value="{{ model }}">{{ model }}</option>#}
                                    {#                                    {% endfor %}#}
                                </select>
                            </div>
                        </div>
                        {#                        <div class="form-group col-md-3 col-sm-6">#}
                        {#                            <div class="select">#}
                        {#                                <select class="form-control" id="category">#}
                        {#                                    <option>Select Category</option>#}
                        {#                                    {% for category in categories %}#}
                        {#                                        <option value="{{ category }}">{{ category }}</option>#}
                        {#                                    {% endfor %}#}
                        {#                                </select>#}
                        {#                            </div>#}
                        {#                        </div>#}


                        <div class="form-group col-md-3 col-sm-6">
                            <div class="select">
                                <select class="form-control" id="transmission" required>
                                    <option value="">Transmission</option>
                                    <option>Manuelle</option>
                                    <option>Automatique</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group col-md-3 col-sm-6">
                            <div class="select">
                                <select class="form-control" id="carburant" required>
                                    <option value="">Fuel Type</option>
                                    <option>Essence</option>
                                    <option>Diesel</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group col-md-6 col-sm-6">
                            <label class="form-label">Kilometers Range </label>
                            <input id="price_range" type="text" class="span2" value="" data-slider-min="1000"
                                   data-slider-max="400000" data-slider-step="1000" data-slider-value="[50000,80000]"
                                   required/>
                        </div>

                        <div class="form-group col-md-3 col-sm-6">
                            <div class="select">
                                <select class="form-control" id="year" required>
                                    <option value="">Select Year</option>
                                    <option value="1980">1980</option>
                                    <option value="1981">1981</option>
                                    <option value="1982">1982</option>
                                    <option value="1983">1983</option>
                                    <option value="1984">1984</option>
                                    <option value="1985">1985</option>
                                    <option value="1986">1986</option>
                                    <option value="1987">1987</option>
                                    <option value="1988">1988</option>
                                    <option value="1989">1989</option>
                                    <option value="1990">1990</option>
                                    <option value="1991">1991</option>
                                    <option value="1992">1992</option>
                                    <option value="1993">1993</option>
                                    <option value="1994">1994</option>
                                    <option value="1995">1995</option>
                                    <option value="1996">1996</option>
                                    <option value="1997">1997</option>
                                    <option value="1998">1998</option>
                                    <option value="1999">1999</option>
                                    <option value="2000">2000</option>
                                    <option value="2001">2001</option>
                                    <option value="2002">2002</option>
                                    <option value="2003">2003</option>
                                    <option value="2004">2004</option>
                                    <option value="2005">2005</option>
                                    <option value="2006">2006</option>
                                    <option value="2007">2007</option>
                                    <option value="2008">2008</option>
                                    <option value="2009">2009</option>
                                    <option value="2010">2010</option>
                                    <option value="2011">2011</option>
                                    <option value="2012">2012</option>
                                    <option value="2013">2013</option>
                                    <option value="2014">2014</option>
                                    <option value="2015">2015</option>
                                    <option value="2016">2016</option>
                                    <option value="2017">2017</option>
                                    <option value="2018">2018</option>
                                    <option value="2019">2019</option>
                                    <option value="2020">2020</option>
                                    <option value="2021">2021</option>
                                    <option value="2022">2022</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group col-md-3 col-sm-6">
                            <button type="submit" value="Submit" class="btn btn-block"
                                    data-toggle="modal"
                                    data-target="#exammarqueeModal"><i class="fa fa-search"
                                                                       aria-hidden="true"></i>
                                Estimate
                            </button>
                        </div>
                    </form>

                </div>

            </div>
        </div>
    </section>
    <!-- /Filter-Form -->


    <!--About-us-->
    <section id="about_us" class="section-padding">
        <div class="container">
            <div class="section-header text-center">
                <h2>Welcome to Priceify</h2>
                <p>Priceify, the n°1 automobile expert in Tunisia! You want to sell your used car at the best price?,
                    You want to but aused car at the best price? You want to know how much fuel your car use? Only one
                    address : Pricefy.
                </p>
            </div>

            <div class="row">
                <div class="col-md-3 col-sm-6">
                    <div class="about_info">
                        <div class="icon_box">
                            <i class="fa fa-money" aria-hidden="true"></i>
                        </div>
                        <h5>Accurate Price</h5>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="about_info">
                        <div class="icon_box">
                            <i class="fa fa-thumbs-o-up" aria-hidden="true"></i>
                        </div>
                        <h5>Sentiment Reports</h5>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="about_info">
                        <div class="icon_box">
                            <i class="fa fa-history" aria-hidden="true"></i>
                        </div>
                        <h5>Fuel Estimation</h5>
                    </div>
                </div>

                <div class="col-md-3 col-sm-6">
                    <div class="about_info">
                        <div class="icon_box">
                            <i class="fa fa-users" aria-hidden="true"></i>
                        </div>
                        <h5>24/7 Support</h5>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--/About-us-->

    <!-- Help-Number-->
    <section id="help" class="section-padding">
        <div class="container">
            <div class="div_zindex white-text text-center">
                <h2>Have Any Question ?<br>
                    (+216) 25 216 111</h2>
            </div>
        </div>

        <!-- Dark-overlay-->
        <div class="dark-overlay"></div>
    </section>
    <!-- /Help-Number-->


    <!--Brands-->
    <section class="brand-section gray-bg">
        <div class="container">
            <div class="brand-hadding">
                <h5>Popular Brands</h5>
            </div>
            <div class="brand-logo-list">
                <div id="popular_brands">
                    <div><a href="#"><img src="{% static "images/audi.png" %}" class="img-responsive" alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/bmw.png" %}" class="img-responsive" alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/peugeot-01.png" %}" class="img-responsive" alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/renault-01.png" %}" class="img-responsive" alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/citroen-01.png" %}" class="img-responsive" alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/ford-01.png" %}" class="img-responsive"
                                          alt="image"></a>
                    </div>
                    <div><a href="#"><img src="{% static "images/mercedes-01.png" %}" class="img-responsive"
                                          alt="image"></a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- /Brands-->


    <script>
        $("#marque").change(function (e) {
            e.preventDefault();
            console.log(document.getElementById("model").value);
            $.ajax({
                type: 'POST',
                url: '{% url "predict:get_selected_model_2" %}',
                data: {
                    marque: $('#marque').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {
                    document.getElementById("model").innerHTML = "";
                    select = document.getElementById("model")
                    for (var i in json) {
                        for (var j in json[i]) {
                            $(select).append('<option value=' + json[i][j] + '>' + json[i][j] + '</option>');
                        }
                    }

                },
                error: function (xhr, errmsg, err) {

                }
            });
        })
    </script>
    <script>
        $(document).on('submit', '#post-form', function (e) {
            e.preventDefault();
            $.ajax({
                type: 'POST',
                url: '{% url "predict:pricepredict" %}',
                data: {
                    marque: $('#marque option:selected').val(),
                    //category: $('#category option:selected').val(),
                    model: $('#model option:selected').val(),
                    transmission: $('#transmission option:selected').val(),
                    carburant: $('#carburant option:selected').val(),
                    year: $('#year option:selected').val(),
                    price_range: $('#price_range').val(),
                    csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                    action: 'post'
                },
                success: function (json) {

                    document.forms["post-form"].reset();
                    document.getElementById("prediction").innerHTML = json['result'] + ' TND'
                },
                error: function (xhr, errmsg, err) {


                }
            });
        })
    </script>

    <script>!(function () {
        let e = document.createElement("script"),
            t = document.head || document.getElementsByTagName("head")[0];
        (e.src =
            "https://cdn.jsdelivr.net/npm/rasa-webchat@1.x.x/lib/index.js"),
            // Replace 1.x.x with the version that you want
            (e.async = !0),
            (e.onload = () => {
                window.WebChat.default(
                    {
                        initPayLoad: '/greet',
                        customData: {language: "en"},
                        socketUrl: "http://localhost:5005",
                        // add other props here
                    },
                    null
                );
            }),
            t.insertBefore(e, t.firstChild);
    })();
    </script>

{% endblock %}